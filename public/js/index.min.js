document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})});const navbar=document.querySelector(".navbar");let lastScroll=0;window.addEventListener("scroll",()=>{const e=window.pageYOffset;e>100?(navbar.style.background="linear-gradient(135deg, rgba(44, 24, 16, 0.98), rgba(44, 24, 16, 1))",navbar.style.boxShadow="0 4px 20px rgba(0, 0, 0, 0.3)"):(navbar.style.background="linear-gradient(135deg, rgba(44, 24, 16, 0.95), rgba(44, 24, 16, 0.98))",navbar.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.2)"),lastScroll=e});const galleryThumbs=document.querySelectorAll(".thumb"),galleryMainVideo=document.querySelector(".gallery-main video"),introContent=document.getElementById("introContent"),characterTitle=document.getElementById("characterTitle"),characterDescription=document.getElementById("characterDescription");let currentCharacter=null;galleryThumbs.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.character,n=e.dataset.title,a=e.dataset.description,o=e.dataset.mainImageWebm,r=e.dataset.mainImageMp4,s=currentCharacter!==t;galleryThumbs.forEach(e=>e.classList.remove("active")),e.classList.add("active"),galleryMainVideo.style.opacity="0",setTimeout(()=>{const e=galleryMainVideo.querySelector('source[type="video/webm"]'),c=galleryMainVideo.querySelector('source[type="video/mp4"]');if(e.src=o,c.src=r,galleryMainVideo.load(),galleryMainVideo.play(),galleryMainVideo.className="gallery-image active","lyre"===t&&galleryMainVideo.classList.add("lyre-character"),galleryMainVideo.style.opacity="1",s){const e=document.getElementById("introText");e.classList.add("fading"),introContent.classList.remove("lyre-mode","hugo-mode","pocus-mode"),"lyre"===t?introContent.classList.add("lyre-mode"):"hugo"===t?introContent.classList.add("hugo-mode"):"pocus"===t&&introContent.classList.add("pocus-mode"),characterTitle.textContent=n,characterDescription.textContent=a,setTimeout(()=>{e.classList.remove("fading")},300),currentCharacter=t}},300)})}),galleryThumbs.length>0&&(currentCharacter=galleryThumbs[0].dataset.character);const observerOptions={threshold:.1,rootMargin:"0px 0px -100px 0px"},observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)")})},observerOptions);document.querySelectorAll(".character-card, .toolkit-card, .henchman-card").forEach(e=>{e.style.opacity="0",e.style.transform="translateY(30px)",e.style.transition="opacity 0.6s ease, transform 0.6s ease",observer.observe(e)});const toolkitCards=document.querySelectorAll(".toolkit-card");toolkitCards.forEach(e=>{const t=e.querySelector("video");if(t){let n=null;e.addEventListener("mouseenter",()=>{n=t.play()}),e.addEventListener("mouseleave",()=>{null!==n?(n.then(()=>{t.pause(),t.currentTime=0}).catch(e=>{console.debug("Video play interrupted:",e)}),n=null):(t.pause(),t.currentTime=0)})}}),window.addEventListener("load",()=>{document.body.style.opacity="0",setTimeout(()=>{document.body.style.transition="opacity 0.5s ease",document.body.style.opacity="1"},100)});let konamiCode=[];const konamiSequence=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];document.addEventListener("keydown",e=>{if(konamiCode.push(e.key),konamiCode.splice(-konamiSequence.length-1,konamiCode.length-konamiSequence.length),konamiCode.join("")===konamiSequence.join("")){document.body.style.animation="rainbow 2s linear infinite";const e=document.createElement("style");e.textContent="\n            @keyframes rainbow {\n                0% { filter: hue-rotate(0deg); }\n                100% { filter: hue-rotate(360deg); }\n            }\n        ",document.head.appendChild(e),setTimeout(()=>{document.body.style.animation="",e.remove()},5e3),console.log("Howdy from Sam the Web Developer. :) ðŸŽ® N64 nostalgia activated! ðŸŽ®")}});const createMobileMenu=()=>{const e=document.querySelector(".mobile-menu-toggle"),t=document.querySelector(".nav-menu"),n=document.querySelectorAll(".nav-link"),a=document.body;if(!e||!t)return void console.warn("Mobile menu elements not found");const o=()=>{t.classList.remove("active"),e.classList.remove("active"),e.setAttribute("aria-expanded","false"),a.style.overflow=""};let r;e.addEventListener("click",()=>{const n=t.classList.toggle("active");e.classList.toggle("active"),e.setAttribute("aria-expanded",n),a.style.overflow=n?"hidden":""}),n.forEach(e=>{e.addEventListener("click",()=>{o()})}),t.addEventListener("click",e=>{e.target===t&&o()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("active")&&o()}),window.addEventListener("resize",()=>{clearTimeout(r),r=setTimeout(()=>{window.innerWidth>768&&t.classList.contains("active")&&o()},150)}),console.log("Mobile menu initialized successfully")};if(createMobileMenu(),"IntersectionObserver"in window){const e=new IntersectionObserver((t,n)=>{t.forEach(t=>{if(t.isIntersecting){const n=t.target;n.src=n.dataset.src,n.classList.remove("lazy"),e.unobserve(n)}})});document.querySelectorAll("img[data-src]").forEach(t=>{e.observe(t)})}const createScrollToTop=()=>{const e=document.createElement("button");e.innerHTML="â†‘",e.className="scroll-to-top",e.style.cssText="\n        position: fixed;\n        bottom: 30px;\n        right: 30px;\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));\n        color: white;\n        border: none;\n        font-size: 24px;\n        cursor: pointer;\n        opacity: 0;\n        transition: opacity 0.3s ease, transform 0.3s ease;\n        z-index: 999;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    ",document.body.appendChild(e),window.addEventListener("scroll",()=>{window.pageYOffset>500?(e.style.opacity="1",e.style.pointerEvents="all"):(e.style.opacity="0",e.style.pointerEvents="none")}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),e.addEventListener("mouseenter",()=>{e.style.transform="scale(1.1) translateY(-3px)"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1) translateY(0)"})};createScrollToTop(),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".world-list-item"),t=document.getElementById("worldContent"),n=document.querySelector('.world-list-item[data-discovered="true"]');n&&n.classList.add("active"),e.forEach(n=>{"true"===n.dataset.discovered&&n.addEventListener("click",function(){e.forEach(e=>e.classList.remove("active")),this.classList.add("active");const n=this.dataset.name,a=this.dataset.description,o=this.dataset.image;t.innerHTML=`\n                    <img src="${o}" alt="${n}" class="world-content-image">\n                    <p class="world-content-text">${a}</p>\n                `})})});let newsCache=null,lastFetchTime=0;const CACHE_DURATION=9e5;async function fetchSteamNews(){const e=Date.now();if(newsCache&&e-lastFetchTime<9e5)return newsCache;try{const t=await fetch("/api/steam-news?count=6"),n=await t.json();return newsCache=n,lastFetchTime=e,n}catch(e){return console.error("Error fetching Steam news:",e),null}}function stripHTML(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}function formatDate(e){return new Date(1e3*e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function createPocusScrollItem(e,t){const n=document.createElement("div");return n.className="scroll-news-item",0===t&&n.classList.add("active"),n.innerHTML=`\n        <div class="scroll-item-date">${formatDate(e.date)}</div>\n        <div class="scroll-item-title">${e.title}</div>\n        <svg viewBox="0 0 24 24" width="32" height="32" class="steam-icon">\n        <path fill="currentColor" d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C7.4,22 3.55,18.92 2.36,14.73L6.19,16.31C6.45,17.6 7.6,18.58 8.97,18.58C10.53,18.58 11.8,17.31 11.8,15.75V15.62L15.2,13.19H15.28C17.36,13.19 19.05,11.5 19.05,9.42C19.05,7.34 17.36,5.65 15.28,5.65C13.2,5.65 11.5,7.34 11.5,9.42V9.47L9.13,12.93L8.97,12.92C8.38,12.92 7.83,13.1 7.38,13.41L2,11.2C2.43,6.05 6.73,2 12,2M8.28,17.17C9.08,17.5 10,17.13 10.33,16.33C10.66,15.53 10.28,14.62 9.5,14.29L8.22,13.76C8.71,13.58 9.26,13.57 9.78,13.79C10.31,14 10.72,14.41 10.93,14.94C11.15,15.46 11.15,16.04 10.93,16.56C10.5,17.64 9.23,18.16 8.15,17.71C7.65,17.5 7.27,17.12 7.06,16.67L8.28,17.17M17.8,9.42C17.8,10.81 16.67,11.94 15.28,11.94C13.9,11.94 12.77,10.81 12.77,9.42A2.5,2.5 0 0,1 15.28,6.91C16.67,6.91 17.8,8.04 17.8,9.42M13.4,9.42C13.4,10.46 14.24,11.31 15.29,11.31C16.33,11.31 17.17,10.46 17.17,9.42C17.17,8.38 16.33,7.53 15.29,7.53C14.24,7.53 13.4,8.38 13.4,9.42Z" />\n        </svg>\n    `,n.addEventListener("click",function(){document.querySelectorAll(".scroll-news-item").forEach(e=>e.classList.remove("active")),this.classList.add("active"),window.open(e.url,"_blank")}),n}async function displayPocusNews(){const e=document.getElementById("pocusNewsList"),t=await fetchSteamNews();if(!t||!t.appnews||!t.appnews.newsitems)return void(e.innerHTML='<div class="news-loading"><p>The magical energies are unstable...</p></div>');const n=t.appnews.newsitems;0!==n.length?(e.innerHTML="",n.forEach((t,n)=>{const a=createPocusScrollItem(t,n);e.appendChild(a)})):e.innerHTML='<div class="news-loading"><p>No magical chronicles yet...</p></div>'}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(displayPocusNews,100)}):setTimeout(displayPocusNews,100),document.addEventListener("visibilitychange",()=>{if(!document.hidden){Date.now()-lastFetchTime>=9e5&&displayPocusNews()}});let newsRefreshedOnScroll=!1;const pocusNewsSection=document.getElementById("pocus-news");if(pocusNewsSection){new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting&&!newsRefreshedOnScroll){Date.now()-lastFetchTime>=9e5&&(displayPocusNews(),newsRefreshedOnScroll=!0)}})},{threshold:.1}).observe(pocusNewsSection)}function createBambooLeaves(){const e=document.getElementById("bambooLeaves");if(!e)return;for(let t=0;t<15;t++){const t=document.createElement("div");t.className="bamboo-leaf",t.style.left=100*Math.random()+"%";const n=10+10*Math.random();t.style.animationDuration=n+"s",t.style.animationDelay=5*Math.random()+"s";const a=.8+.4*Math.random();t.style.transform=`scale(${a})`,e.appendChild(t)}}function createSandParticles(){const e=document.getElementById("sandParticles");if(!e)return;for(let t=0;t<30;t++){const t=document.createElement("div");t.className="sand-particle",t.style.top=100*Math.random()+"%";const n=15+15*Math.random();t.style.animationDuration=n+"s",t.style.animationDelay=10*Math.random()+"s";const a=2+3*Math.random();t.style.width=a+"px",t.style.height=a+"px",e.appendChild(t)}}function createTarBubbles(){const e=document.getElementById("tarBubbles");if(!e)return;for(let t=0;t<12;t++){const t=document.createElement("div");t.className="tar-bubble",t.style.left=100*Math.random()+"%";const n=8+8*Math.random();t.style.animationDuration=n+"s",t.style.animationDelay=8*Math.random()+"s";const a=20+30*Math.random();t.style.width=a+"px",t.style.height=a+"px",e.appendChild(t)}}function createSnowParticles(){const e=document.getElementById("snowParticles");if(!e)return;for(let t=0;t<50;t++){const t=document.createElement("div");t.className="snow-particle",t.style.left=100*Math.random()+"%";const n=8+8*Math.random();t.style.animationDuration=n+"s",t.style.animationDelay=8*Math.random()+"s";const a=4+8*Math.random();t.style.width=a+"px",t.style.height=a+"px",e.appendChild(t)}}document.getElementById("bambooLeaves")&&createBambooLeaves(),document.getElementById("sandParticles")&&createSandParticles(),document.getElementById("tarBubbles")&&createTarBubbles(),document.getElementById("snowParticles")&&createSnowParticles(),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".gallery-dot"),t=document.querySelectorAll(".gallery-slide");let n,a=0;function o(n){t.forEach(e=>e.classList.remove("active")),e.forEach(e=>e.classList.remove("active")),t[n].classList.add("active"),e[n].classList.add("active"),a=n}function r(){o((a+1)%t.length)}e.forEach(e=>{e.addEventListener("click",()=>{o(parseInt(e.dataset.index)),clearInterval(n),n=setInterval(r,5e3)})}),t.length>0&&(n=setInterval(r,5e3))});let players={},playersReady={},ytApiLoaded=!1;function checkYouTubeAPI(){return"undefined"!=typeof YT&&void 0!==YT.Player}function initYouTubePlayers(){if(!checkYouTubeAPI())return console.warn("YouTube API not ready, retrying in 500ms..."),void setTimeout(initYouTubePlayers,500);const e={ytplayer1:"PWT8Bv2TouY",ytplayer2:"cecbsgCJeF4",ytplayer3:"U_51KX2r2Jo"};Object.keys(e).forEach(t=>{if(document.getElementById(t))try{players[t]=new YT.Player(t,{height:"0",width:"0",videoId:e[t],playerVars:{playsinline:1,controls:0,modestbranding:1,rel:0,enablejsapi:1,origin:window.location.origin},events:{onReady:onPlayerReady,onError:onPlayerError}})}catch(e){e.message.includes("blocked")||console.error(`Error creating player ${t}:`,e)}else console.error(`Player element ${t} not found`)})}function onPlayerReady(e){const t=e.target.getIframe().id;playersReady[t]=!0,console.log(`âœ… Player ${t} ready`),e.target.setVolume(50),document.querySelectorAll(`.play-btn[data-player="${t}"]`).forEach(e=>{e.addEventListener("click",()=>{try{players[t]&&playersReady[t]?players[t].playVideo():console.warn(`Player ${t} not ready`)}catch(e){console.error(`Error playing ${t}:`,e)}})}),document.querySelectorAll(`.pause-btn[data-player="${t}"]`).forEach(e=>{e.addEventListener("click",()=>{try{players[t]&&playersReady[t]?players[t].pauseVideo():console.warn(`Player ${t} not ready`)}catch(e){console.error(`Error pausing ${t}:`,e)}})}),document.querySelectorAll(`.volume-slider[data-player="${t}"]`).forEach(e=>{e.addEventListener("input",e=>{try{players[t]&&playersReady[t]&&players[t].setVolume(e.target.value)}catch(e){console.error(`Error setting volume ${t}:`,e)}})})}function onPlayerError(e){const t=e.target.getIframe().id;console.error(`YouTube player error for ${t}:`,e.data),playersReady[t]=!1}window.onYouTubeIframeAPIReady=function(){ytApiLoaded=!0,console.log("âœ… YouTube API loaded"),initYouTubePlayers()},checkYouTubeAPI()&&(ytApiLoaded=!0,initYouTubePlayers()),console.log("ðŸŽµ Harper and Lyre website loaded! ðŸŽ®");